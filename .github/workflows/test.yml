name: Python Tests

on:
 push:
   branches: [ main ]
 pull_request:
   branches: [ main ]

jobs:
 test:
   runs-on: ubuntu-latest
   strategy:
     matrix:
       python-version: ["3.10", "3.11", "3.12"]

   steps:
   - uses: actions/checkout@v4

   - name: Set up Python ${{ matrix.python-version }}
     uses: actions/setup-python@v5
     with:
       python-version: ${{ matrix.python-version }}

   - name: Install Poetry
     run: |
       curl -sSL https://install.python-poetry.org | python3 -

   - name: Configure Poetry
     run: |
       poetry config virtualenvs.create true
       poetry config virtualenvs.in-project true

   - name: Cache Poetry virtualenv
     uses: actions/cache@v4
     with:
       path: ./.venv
       key: venv-${{ runner.os }}-${{ matrix.python-version }}-${{ hashFiles('**/poetry.lock') }}

   - name: Install dependencies
     run: poetry install

   - name: Run tests
     run: |
       poetry run python -m pytest tests/ -v